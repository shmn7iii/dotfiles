#!/bin/bash -eu

cd ~


echo "\n========================================"
echo " 🏝 Homebrew をインストールするよ"
echo "========================================\n"
if [ ! -f /usr/local/bin/brew ]
 then
  echo "Installing Homebrew..."
  /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
 else
  echo "Homebrew already installed."
fi



echo "\n========================================"
echo " 🏝 shmn7iii/dotfiles をクローンするよ"
echo "========================================\n"
if [ ! -d ~/.shmn7iii/dotfiles ]
 then
  cd ~/.ssh
  ssh-keygen
  pbcopy < ~/.ssh/id_rsa.pub
  echo "クリップボードに~/.ssh/id_rsa.pubをコピーしました。"
  echo "公開鍵をGitHubに登録してください > "
  select yn in "Yes"; do
   case $yn in
    Yes ) break;;
   esac
  done

  echo "Cloning dotfiles..."
	mkdir ~/.shmn7iii
	cd ~/.shmn7iii
  git clone git@github.com:shmn7iii/dotfiles.git
 else
  echo "dotfiles already cloned."
fi



echo "\n========================================"
echo " 🏝 Brewfile の内容をインストールするよ"
echo "========================================\n"
echo "Installing some software & library..."
brew update
brew upgrade
brew bundle -v --file=~/.shmn7iii/dotfiles/Brewfile



echo "\n========================================"
echo " 🏝 git-prompt,completion の設定をするよ"
echo "========================================\n"
mkdir ~/.zsh
echo "Installing git-prompt.sh"
curl -o ~/.zsh/git-prompt.sh https://raw.githubusercontent.com/git/git/master/contrib/completion/git-prompt.sh
echo "Installing git-completion.bash"
curl -o ~/.zsh/git-completion.bash https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.bash
echo "Installing git-completion.zsh (rename to _git)"
curl -o ~/.zsh/_git https://raw.githubusercontent.com/git/git/master/contrib/completion/git-completion.zsh



echo "\n========================================"
echo " 🏝 .zshrc を連れてくるよ"
echo "========================================\n"
cp ~/.shmn7iii/dotfiles/.zshrc ~/.zshrc
source ~/.zshrc



echo "\n========================================"
echo " 🏝 .vimrc を連れてくるよ"
echo "========================================\n"
ln -fs ~/.shmn7iii/dotfiles/.vimrc ~/.vimrc



echo "\n========================================"
echo " 🏝 .config/git/ignore を連れてくるよ"
echo "========================================\n"
mkdir -p ~/.config/git
ln -fs ~/.shmn7iii/dotfiles/.config/git/ignore ~/.config/git/ignore



echo "\n========================================"
echo " 🏝 anyenv の設定をするよ"
echo "========================================\n"
ln -fs ~/.shmn7iii/dotfiles/.config/anyenv ~/.config/anyenv
anyenv init
anyenv install --init



echo "\n========================================"
echo " 🏝 mac 特有の設定をするよ"
echo "========================================\n"
defaults write com.apple.finder QuitMenuItem -bool true
defaults write com.apple.dock springboard-columns -int 8
defaults write com.apple.dock springboard-rows -int 6
defaults write com.apple.dock ResetLaunchPad -bool TRUE
defaults write com.apple.Dock autohide-delay -float 0
killall Dock



echo "\n========================================"
echo " 🏝 source ~/.zshrc"
echo "========================================\n"
source ~/.zshrc



echo "\n========================================"
echo " 🏝 終了！！！"
echo "========================================"
